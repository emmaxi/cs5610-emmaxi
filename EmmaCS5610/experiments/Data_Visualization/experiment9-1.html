<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>

    <title>experiment9-1</title>
    <script type="text/javascript" src="js/jquery-1.11.2.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.15/angular.min.js"></script>
    
    <!-- D3.Js Import -->
    <script src="http://d3js.org/d3.v3.min.js"></script>
    
</head>
<body class="container">
<h1>How to make a draggable graph using JS plugin?</h1>

 <p class="lead">Pie-Chart</p>
    <div class = "container well">
      <p>Click the Radio Buttons to change the Piechart</p><br/>

    <form>
      <label><input type="radio" name="dataset" value="CS" checked> CS</label>
      <label><input type="radio" name="dataset" value="IA"> IA</label>
    </form>

    <svg id="grapharea" width="960" height="500"
  viewBox="0 0 960 500"
  preserveAspectRatio="xMidYMid"></svg>

    <script>
        //------------------D3 Script *Starts* -------------------------

        var width = 960,
          height = 500,
          radius = Math.min(width, height) / 2;

        var color = d3.scale.category10();

        var pie = d3.layout.pie()
          .value(function (d) { return d.CS; })
          .sort(null);

        var arc = d3.svg.arc()
          .innerRadius(radius - 100)
          .outerRadius(radius - 20);

        var svg = d3.select("#grapharea").append("svg")
          .attr("width", width)
          .attr("height", height)
        .append("g")
          .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

        d3.tsv("pieData.tsv", type, function (error, data) {
            var path = svg.datum(data).selectAll("path")
            .data(pie)
          .enter().append("path")
            .attr("fill", function (d, i) { return color(i); })
            .attr("d", arc)
            .each(function (d) { this._current = d; }); // store the initial angles

            d3.selectAll("input")
            .on("change", change);

            var timeout = setTimeout(function () {
                d3.select("input[value=\"IA\"]").property("checked", true).each(change);
            }, 2000);

            function change() {
                var value = this.value;
                clearTimeout(timeout);
                pie.value(function (d) { return d[value]; }); // change the value function
                path = path.data(pie); // compute the new angles
                path.transition().duration(750).attrTween("d", arcTween); // redraw the arcs
            }
        });

        function type(d) {
            d.CS = +d.CS;
            d.IA = +d.IA;
            return d;
        }

        // Store the displayed angles in _current.
        // Then, interpolate from _current to the new angles.
        // During the transition, _current is updated in-place by d3.interpolate.
        function arcTween(a) {
            var i = d3.interpolate(this._current, a);
            this._current = i(0);
            return function (t) {
                return arc(i(t));
            };
        }
        //------------------D3 Script *Ends*-------------------------
</script>
    </div>


<p >
        This a widget that is commonly used in representing data analysis, in many domains.<br/>
       D3.Js gives us a good control over this widget. We can represent data and animate the pie chart as the data changes, thus facilitating the user interactivity.  </p>
<p>In this experiments,
            first of all,import the D2.js file and the other dependent files(such as angularJS and JQuery).
        </p>
        <pre>
        &lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery-1.11.2.js&quot;&gt;&lt;/script&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css&quot;&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css&quot;&gt;
    &lt;script src=&quot;https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;http://ajax.googleapis.com/ajax/libs/angularjs/1.2.15/angular.min.js&quot;&gt;&lt;/script&gt;
    
    &lt;!-- D3.Js Import --&gt;
    &lt;script src=&quot;http://d3js.org/d3.v3.min.js&quot;&gt;&lt;/script&gt;
        </pre>
        <p>Then, the data file is shown like below:</p>
        <pre>
        CS	IA
        245	200
        479	100
        697	200
        137	300
        245	200
        </pre>
        <p>
        The javascript code for this pie chart effact is that:
        </p>
        <pre>
          var width = 960,
          height = 500,
          radius = Math.min(width, height) / 2;

        var color = d3.scale.category10();

        var pie = d3.layout.pie()
          .value(function (d) { return d.CS; })
          .sort(null);

        var arc = d3.svg.arc()
          .innerRadius(radius - 100)
          .outerRadius(radius - 20);

        var svg = d3.select("#grapharea").append("svg")
          .attr("width", width)
          .attr("height", height)
        .append("g")
          .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

        d3.tsv("pieData.tsv", type, function (error, data) {
            var path = svg.datum(data).selectAll("path")
            .data(pie)
          .enter().append("path")
            .attr("fill", function (d, i) { return color(i); })
            .attr("d", arc)
            .each(function (d) { this._current = d; }); // store the initial angles

            d3.selectAll("input")
            .on("change", change);

            var timeout = setTimeout(function () {
                d3.select("input[value=\"IA\"]").property("checked", true).each(change);
            }, 2000);

            function change() {
                var value = this.value;
                clearTimeout(timeout);
                pie.value(function (d) { return d[value]; }); // change the value function
                path = path.data(pie); // compute the new angles
                path.transition().duration(750).attrTween("d", arcTween); // redraw the arcs
            }
        });

        function type(d) {
            d.CS = +d.CS;
            d.IA = +d.IA;
            return d;
        }

        // Store the displayed angles in _current.
        // Then, interpolate from _current to the new angles.
        // During the transition, _current is updated in-place by d3.interpolate.
        function arcTween(a) {
            var i = d3.interpolate(this._current, a);
            this._current = i(0);
            return function (t) {
                return arc(i(t));
            };
        }
        </pre>

    <hr/>
 
  <h2>relative code</h2>
   <a href="../../fileview/Default.aspx?~/experiments/Data_Visualization/Experiment9-1.html" target="_blank">Experiment9-1 Html Source</a><br />
   <p >The pie chart shown above is constructed from a file that can be found <a href="pieData.tsv">HERE</a>.<br/>
  <h3>References:</h3>
    <a href="http://d3js.org/" target="_blank">D3.js website</a><br />
 <footer>Copyright by Xi Wang</footer>


	<!-- USE Hosted Angular Script -->
	<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.15/angular.min.js"></script>

</body>

</html>
